from ga4gh.vrs import models

from anyvar.utils.liftover_utils import (
    CoordinateConversionFailureError,
    UnsupportedReferenceAssemblyError,
)

test_variants = {
    # example from PUT /variation
    "allele_int_rle_grch37_variant": {
        "variant_input": {
            "id": "ga4gh:VA.d6ru7RcuVO0-v3TtPFX5fZz-GLQDhMVb",
            "type": "Allele",
            "digest": "d6ru7RcuVO0-v3TtPFX5fZz-GLQDhMVb",
            "location": {
                "id": "ga4gh:SL.JOFKL4nL5mRUlO_xLwQ8VOD1v7mxhs3I",
                "type": "SequenceLocation",
                "digest": "JOFKL4nL5mRUlO_xLwQ8VOD1v7mxhs3I",
                "sequenceReference": {
                    "type": "SequenceReference",
                    "refgetAccession": "SQ.IW78mgV5Cqf6M24hy52hPjyyo5tCCd86",
                },
                "start": 36561661,
                "end": 36561663,
            },
            "state": {
                "type": "ReferenceLengthExpression",
                "length": 0,
                "sequence": "",
                "repeatSubunitLength": 2,
            },
        },
        "expected_output": models.Allele(
            id="ga4gh:VA.QiKnpRR8S7SPoUE-RMUJJbT-RS1akuHA",
            digest="QiKnpRR8S7SPoUE-RMUJJbT-RS1akuHA",
            type="Allele",
            location=models.SequenceLocation(
                id="ga4gh:SL.0FYyfN4jIyShfruHwdYrSQ-2qmvuVNFK",
                digest="0FYyfN4jIyShfruHwdYrSQ-2qmvuVNFK",
                type="SequenceLocation",
                sequenceReference=models.SequenceReference(
                    refgetAccession="SQ.F-LrLMe1SRpfUZHkQmvkVKFEGaoDeHul",
                    type="SequenceReference",
                    id=None,
                    name=None,
                    description=None,
                    aliases=None,
                    extensions=None,
                    sequence=None,
                    moleculeType=None,
                    residueAlphabet=None,
                    circular=None,
                ),
                start=36522055,
                end=36522057,
                name=None,
                description=None,
                aliases=None,
                extensions=None,
                sequence=None,
            ),
            state=models.ReferenceLengthExpression(
                id=None,
                type="ReferenceLengthExpression",
                length=0,
                sequence=models.sequenceString(""),
                repeatSubunitLength=2,
                name=None,
                description=None,
                aliases=None,
                extensions=None,
            ),
            name=None,
            description=None,
            aliases=None,
            extensions=None,
        ),
    },
    "copynumber_ranged_positive_grch37_variant": {
        "variant_input": {
            "id": "ga4gh:CN.CTCgVehH0FEqrlaOMhUsDjKwzavnQegk",
            "type": "CopyNumberCount",
            "location": {
                "sequenceReference": {
                    "type": "SequenceReference",
                    "refgetAccession": "SQ.iy_UbUrvECxFRX5LPTH_KPojdlT7BKsf",
                },
                "start": [None, 29652251],
                "end": [29981821, None],
                "type": "SequenceLocation",
            },
            "copies": 3,
        },
        "expected_output": models.CopyNumberCount(
            id="ga4gh:CN.fmrn873tRhAiNLybjHlftgHjcAEExPKQ",
            digest="fmrn873tRhAiNLybjHlftgHjcAEExPKQ",
            type="CopyNumberCount",
            name=None,
            description=None,
            aliases=None,
            extensions=None,
            location=models.SequenceLocation(
                id="ga4gh:SL.7HsIbSybxJRfiRNr2r0gz1JNsV-wJJfQ",
                type="SequenceLocation",
                digest="7HsIbSybxJRfiRNr2r0gz1JNsV-wJJfQ",
                name=None,
                description=None,
                aliases=None,
                extensions=None,
                sequence=None,
                sequenceReference=models.SequenceReference(
                    id=None,
                    type="SequenceReference",
                    name=None,
                    description=None,
                    aliases=None,
                    extensions=None,
                    refgetAccession="SQ.-A1QmD_MatoqxvgVxBLZTONHz9-c7nQo",
                    sequence=None,
                    moleculeType=None,
                    residueAlphabet=None,
                    circular=None,
                ),
                start=models.Range([None, 30417575]),
                end=models.Range([31394018, None]),
            ),
            copies=3,
        ),
    },
    # BRAF V600E
    "allele_int_negative_grch38_variant": {
        "variant_input": {
            "id": "ga4gh:VA.Otc5ovrw906Ack087o1fhegB4jDRqCAe",
            "type": "Allele",
            "digest": "Otc5ovrw906Ack087o1fhegB4jDRqCAe",
            "location": {
                "id": "ga4gh:SL.nhul5x5P_fKjGEpY9PEkMIekJfZaKom2",
                "type": "SequenceLocation",
                "digest": "nhul5x5P_fKjGEpY9PEkMIekJfZaKom2",
                "sequenceReference": {
                    "type": "SequenceReference",
                    "refgetAccession": "SQ.F-LrLMe1SRpfUZHkQmvkVKFEGaoDeHul",
                },
                "start": 140753335,
                "end": 140753336,
            },
            "state": {"type": "LiteralSequenceExpression", "sequence": "T"},
        },
        "expected_output": models.Allele(
            id="ga4gh:VA.nmp-bzYpO00NYIqr3CaVF0ZH2ZpSj1ly",
            digest="nmp-bzYpO00NYIqr3CaVF0ZH2ZpSj1ly",
            aliases=None,
            description=None,
            expressions=None,
            extensions=None,
            type="Allele",
            location=models.SequenceLocation(
                id="ga4gh:SL.hVna-JOV5bBTGdXexL--IQm135MG3bGT",
                digest="hVna-JOV5bBTGdXexL--IQm135MG3bGT",
                aliases=None,
                description=None,
                end=140453136,
                extensions=None,
                name=None,
                sequence=None,
                sequenceReference=models.SequenceReference(
                    aliases=None,
                    circular=None,
                    description=None,
                    extensions=None,
                    id=None,
                    moleculeType=None,
                    name=None,
                    refgetAccession="SQ.IW78mgV5Cqf6M24hy52hPjyyo5tCCd86",
                    residueAlphabet=None,
                    sequence=None,
                    type="SequenceReference",
                ),
                start=140453135,
                type="SequenceLocation",
            ),
            name=None,
            state=models.LiteralSequenceExpression(
                aliases=None,
                description=None,
                extensions=None,
                id=None,
                name=None,
                sequence=models.sequenceString("T"),
                type="LiteralSequenceExpression",
            ),
        ),
    },
    "allele_int_unknown_grch38_variant": {
        "variant_input": {
            "id": "ga4gh:VA.9gW_iJbQAIO3SIxJ9ACyAZA1X2lEgO39",
            "digest": "9gW_iJbQAIO3SIxJ9ACyAZA1X2lEgO39",
            "type": "Allele",
            "location": {
                "id": "ga4gh:SL.sK161kPiQBsm-qOErlsNRXeT3nvoTLLn",
                "digest": "sK161kPiQBsm-qOErlsNRXeT3nvoTLLn",
                "sequenceReference": {
                    "refgetAccession": "SQ.Zu7h9AggXxhTaGVsy7h_EZSChSZGcmgX",
                    "type": "SequenceReference",
                },
                "start": 179203760,
                "end": 179203761,
                "type": "SequenceLocation",
            },
            "state": {"sequence": "G", "type": "LiteralSequenceExpression"},
        },
        "expected_output": models.Allele(
            id="ga4gh:VA.J-gW7La8EblIdT1MfqZzhzbO26lkEH7D",
            digest="J-gW7La8EblIdT1MfqZzhzbO26lkEH7D",
            aliases=None,
            description=None,
            expressions=None,
            extensions=None,
            location=models.SequenceLocation(
                aliases=None,
                description=None,
                digest="yuqVJ7v6Q1h7-oXiyVToQn0AsukMMRb8",
                end=178921549,
                extensions=None,
                id="ga4gh:SL.yuqVJ7v6Q1h7-oXiyVToQn0AsukMMRb8",
                name=None,
                sequence=None,
                sequenceReference=models.SequenceReference(
                    aliases=None,
                    circular=None,
                    description=None,
                    extensions=None,
                    id=None,
                    moleculeType=None,
                    name=None,
                    refgetAccession="SQ.VNBualIltAyi2AI_uXcKU7M9XUOuA7MS",
                    residueAlphabet=None,
                    sequence=None,
                    type="SequenceReference",
                ),
                start=178921548,
                type="SequenceLocation",
            ),
            name=None,
            state=models.LiteralSequenceExpression(
                aliases=None,
                description=None,
                extensions=None,
                id=None,
                name=None,
                sequence=models.sequenceString("G"),
                type="LiteralSequenceExpression",
            ),
            type="Allele",
        ),
    },  # FAILURES
    "grch36_variant": {  # Variant that's on an unsupported assembly (GRCh36)
        "variant_input": {
            "digest": "4dEsVNR2JC_ZiHsYSGZgariIUOfYl6a0",
            "id": "ga4gh:VA.4dEsVNR2JC_ZiHsYSGZgariIUOfYl6a0",
            "type": "Allele",
            "location": {
                "id": "ga4gh:SL.WROR90lhzJwgTPgxZx8dRP4Vcjr3BdDi",
                "digest": "WROR90lhzJwgTPgxZx8dRP4Vcjr3BdDi",
                "type": "SequenceLocation",
                "start": 45103598,
                "end": 45103599,
                "sequenceReference": {
                    "refgetAccession": "SQ.JY7UegcaYT-M0PYn1yDGQ_4XJsa-DsXq",
                    "type": "SequenceReference",
                },
            },
            "state": {"sequence": "T", "type": "LiteralSequenceExpression"},
        },
        "expected_output": UnsupportedReferenceAssemblyError,
    },
    "unconvertible_grch37_variant": {
        "variant_input": {
            "id": "ga4gh:VA.qP-qtMJqKhTEJfpTdAZN9CoIFCRKv4kg",
            "type": "Allele",
            "digest": "qP-qtMJqKhTEJfpTdAZN9CoIFCRKv4kg",
            "location": {
                "id": "ga4gh:SL.VqjvHF-g0sA8syECkQvnsVlK66zHtrHU",
                "type": "SequenceLocation",
                "digest": "VqjvHF-g0sA8syECkQvnsVlK66zHtrHU",
                "sequenceReference": {
                    "type": "SequenceReference",
                    "refgetAccession": "SQ.-BOZ8Esn8J88qDwNiSEwUr5425UXdiGX",
                },
                "start": 47087473,
                "end": 47087474,
            },
            "state": {"type": "LiteralSequenceExpression", "sequence": "T"},
        },
        "expected_output": CoordinateConversionFailureError,
    },
    "unconvertible_grch38_variant": {  # see: https://www.ncbi.nlm.nih.gov/clinvar/variation/3035826/?oq=NC_000017.11:50150040:GC:GCGC&m=NM_032595.5(PPP1R9B):c.472_473dup%20(p.Ala159fs)
        "variant_input": {
            "digest": "5-m9wM6WTY5osPxLFg1_bITsOwSoMFui",
            "id": "ga4gh:VA.5-m9wM6WTY5osPxLFg1_bITsOwSoMFui",
            "location": {
                "digest": "IvygUHxpbRf558JG7ZuPYZrZhL_eMp0O",
                "end": 50150042,
                "id": "ga4gh:SL.IvygUHxpbRf558JG7ZuPYZrZhL_eMp0O",
                "sequenceReference": {
                    "refgetAccession": "SQ.dLZ15tNO1Ur0IcGjwc3Sdi_0A6Yf4zm7",
                    "type": "SequenceReference",
                },
                "start": 50150040,
                "type": "SequenceLocation",
            },
            "state": {
                "length": 4,
                "repeatSubunitLength": 2,
                "sequence": "GCGC",
                "type": "ReferenceLengthExpression",
            },
            "type": "Allele",
        },
        "expected_output": CoordinateConversionFailureError,
    },
    "empty_variation_object": {
        "variant_input": {},
        "expected_output": None,
    },
    "invalid_variant": {
        "variant_input": {
            "location": {
                "id": "ga4gh:SL.aCMcqLGKClwMWEDx3QWe4XSiGDlKXdB8",
                "end": 0,
                "start": -1,
                "sequenceReference": {
                    "refgetAccession": "SQ.ss8r_wB0-b9r44TQTMmVTI92884QvBiB",
                    "type": "SequenceReference",
                },
                "type": "SequenceLocation",
            },
            "state": {"sequence": "T", "type": "LiteralSequenceExpression"},
            "type": "UNSUPPORTED",
        },
        "expected_output": None,
    },
}


# STILL NEED:
# - A variant that exists on GRCh38 but not GRCH37
